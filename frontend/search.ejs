<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="/css/search.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@100..900&display=swap" rel="stylesheet">
</head>

<body>

    <%- include('partials/header1') %>

        <section class="section1">
            <div class="searchbox">
                <h2>فقط یک جستجو با بهترین پزشکان فاصله دارید</h2>
                <p>در کمتر از ۱ دقیقه نوبت خود را رزرو کنید</p>
                <div class="search">
                    <img src="images\elements.png">
                    <form id="search-form" action="/search" method="POST">
                        <input type="text" name="search" placeholder="پزشک یا تخصص مورد نظر را جستجو کنید" />
                        <!-- <button id="submit" type="submit"> جستجو </button> -->
                    </form>
                </div>
            </div>
        </section>
        <section class="section2">
            <div class="section2-in">
                <div class="sectionone">
                    <%doctors.forEach(doctor=>{%>
                        <div class="sectionone-in">
                            <div class="angry-grid">
                                <div id="item-0"><img src="images\<%=doctor.image_url%>"></div>
                                <div id="item-1">
                                    <a class="btn1" >پشتیبانی</a>
                                    <a class="btn2" href="/flow/<%=doctor.id%>">رزرو نوبت</a>
                                </div>
                                <div id="item-2">
                                    <div class="doctor-row">
                                        <div class="doctor-code">
                                            <span>کد نظام پزشکی: <%=doctor.description[0].code%></span>
                                            <img src="images\Vector.png" class="check-icon" alt="check">
                                        </div>
                                        <div class="doctor-name">
                                            <%=doctor.first_name%>
                                                <%=doctor.last_name%>
                                        </div>
                                    </div>
                                    <div class="doctor-info">
                                        <p class="doctor-specialty">
                                            <%=doctor.spetialty.spetialty%>
                                        </p>
                                        <div class="rating">
                                            <span class="rate-number">(۱۵۰ نظر)</span>
                                            <span class="stars">★★★★★</span>
                                        </div>
                                    </div>
                                </div>
                                <div id="item-3">
                                    <div class="address">
                                        <%=doctor.description[0].Addres%>
                                            <img src="images\map-pinpoint-02.png">
                                    </div>
                                    <div class="time">
                                        اولین نوبت در دسترس: دوشنبه ۲۴ دی
                                        <img src="images\alarm-clock.png">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <%})%>

                </div>
                <form action="/search" method="post">
                    <div class="filter-box" dir="rtl">
                        <div class="filter-header">
                            <h3>فیلترها</h3>
                            <a href="/search">حذف همه فیلترها ✕</a>
                        </div>
                        <!-- <div class="filterbox-in">
                            <input type="text" placeholder="جستجو پزشک">
                            <label class="label1">نام یا تخصص مورد نظرتان را وارد کنید.</label>
                        </div> -->
                        <hr>
                        <div class="filterbox-in">
                            <label>تخصص ها</label>
                            <select name="spetialty">
                                <option value="">تخصص مورد نظر را انتخاب کنید</option>
                                <%spti.forEach(option=>{%>
                                    <option value="<%=option.spetialty%>"><%=option.spetialty%></option>
                                <%})%>
                            </select>
                        </div>
                        <hr>
                        <!-- <div class="filterbox-in">
                            <label>بیمه</label>
                            <select name="bime">
                                <option>بیمه مورد نظر را انتخاب کنید</option>
                            </select>
                        </div> -->
                        <!-- <hr>
                        <div class="filterbox-in">
                            <label>تجربه کاری</label>
                            <select name="workExperience">
                                <option>تجربه کاری مورد نظر خود را انتخاب کنید</option>
                            </select>
                        </div>
                        <hr>
                        <div class="filterbox-in">
                            <label>وضعیت نوبت دهی</label>
                            
                            <div class="checkbox-group">
                                <label><input type="checkbox" name="aptmStatus" checked> پزشکان دارای نوبت خالی</label>
                                <label><input type="checkbox" name="aptmStatus"> امکان ویزیت آنلاین</label>
                                <label><input type="checkbox" name="aptmStatus" checked> امکان نوبت حضوری</label>
                            </div>
                        </div> -->
                        <hr>
                        <div class="filterbox-in">
                            <label>شهر</label>
                            <select name="city">
                                <option value="">انتخاب شهر</option>
                                <%cities.forEach(city=>{%>
                                    <option value="<%=city.city%>"><%=city.city%></option>
                                <%})%>
                            </select>
                            <div class="checkbox-group">
                                <label><input type="checkbox" name="city" value="تهران"> تهران</label>
                                <label><input type="checkbox" name="city" value="اصفهان"> اصفهان</label>
                                <label><input type="checkbox" name="city" value="شیراز"> شیراز</label>
                                <label><input type="checkbox" name="city" value="تبریز"> تبریز</label>
                            </div>
                        </div>
                        <hr> 
                        <div class="filterbox-in">
                            <label>جنسیت پزشک</label>
                            <div class="gender">
                                <label><input type="checkbox" name="gender" value="FEMALE" name="gender"> خانم</label>
                                <label><input type="checkbox" name="gender" value="MALE" name="gender"> آقا</label>
                            </div>
                        </div>
                        <button class="button">اعمال فیلترها</button>
                </form>
            </div>
            </div>
        </section>

        <%- include('partials/footer') %>

</body>
<script defer>
  const thumbsCont = document.getElementById('item-1');
  const Up = document.getElementById('yesBtn');
  const Down = document.getElementById('noBtn');

  thumbsCont.addEventListener('click' , (e)=>{
    if(e.target.closest('#yesBtn')){
      Up.firstElementChild.src='recourses/vectors/thumbs-up[accent].svg'
      Down.firstElementChild.src='recourses/vectors/thumbs-down[grey].svg'
      Up.style = 'transition:all 0.2s ease ; color: var(--accent);border-color: var(--accent)'
      Down.style = ''
    }
    if(e.target.closest('#noBtn')){
      Up.firstElementChild.src='recourses/vectors/thumbs-up[grey].svg'
      Down.firstElementChild.src='recourses/vectors/thumbs-down[accent].svg'
      Down.style = 'transition:all 0.2s ease ;color: var(--accent);border-color: var(--accent)'
      Up.style = ''
    }
  })

  // ============================================
        // Normalization helpers (Persian/Arabic character normalization)
        // ============================================
        function normalizePersian(input) {
            if (!input && input !== 0) return '';
            return String(input)
                .replace(/\u200C/g, '')          // remove zero-width non-joiner
                .replace(/[\u064B-\u0652]/g, '') // remove Arabic diacritics if any
                .replace(/ي/g, 'ی')               // Arabic Yeh -> Persian Yeh
                .replace(/ك/g, 'ک')               // Arabic Kaf -> Persian Kaf
                .replace(/[أإآ]/g, 'ا')           // different Alef forms
                .replace(/ؤ/g, 'و')
                .replace(/ئ/g, 'ی')
                .replace(/ھ/g, 'ه')
                .replace(/\s+/g, ' ')            // collapse whitespace
                .trim()
                .toLowerCase();
        }

        // ============================================
        // RENDER DOCTORS
        // ============================================
        // function renderDoctors(doctorsToShow) {
        //     const doctorContainer = document.getElementById('doctorsList');
        //     doctorContainer.innerHTML = '';

        //     if (!doctorsToShow  doctorsToShow.length === 0) {
        //         doctorContainer.innerHTML = `
        //             <div style="padding: 40px; text-align: center; color: #666; font-size: 18px;">
        //                 ⚠️ پزشکی با این مشخصات یافت نشد
        //             </div>
        //         `;
        //         return;
        //     }}
        // function initializeSearchHandlers() {
        //     const searchBtn = document.getElementById('searchBtn');
        //     const mainInput = document.getElementById('mainSearchInput');

        //     // clicking magnifier triggers full filter+search
        //     if (searchBtn) {
        //         searchBtn.addEventListener('click', function() {
        //             console.log('Magnifier clicked — running search');
        //             applyAllFilters();
        //         });
        //     }

        //     // pressing Enter inside main input will trigger search too
        //     if (mainInput) {
        //         mainInput.addEventListener('keydown', function(e) {
        //             if (e.key === 'Enter') {
        //                 e.preventDefault();
        //                 console.log('Enter pressed — running search');
        //                 applyAllFilters();
        //             }
        //         });
        //     }

        //     // IMPORTANT: do NOT search on every keystroke — that was the request
        // }

</script>

</html>